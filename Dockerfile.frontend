# å‰ç«¯ç”Ÿäº§ç¯å¢ƒDockerfile
# ğŸ“š çŸ¥è¯†ç‚¹ï¼šé™æ€æ–‡ä»¶æœåŠ¡å™¨é…ç½®

# æ„å»ºé˜¶æ®µ
FROM node:18-alpine AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶packageæ–‡ä»¶
COPY frontend/package*.json ./

# å®‰è£…ä¾èµ–
RUN npm ci

# å¤åˆ¶æºä»£ç 
COPY frontend/ .

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
RUN npm run build

# ç”Ÿäº§é˜¶æ®µ - ä½¿ç”¨nginxæœåŠ¡é™æ€æ–‡ä»¶
FROM nginx:alpine AS production

# å¤åˆ¶æ„å»ºäº§ç‰©åˆ°nginxç›®å½•
COPY --from=builder /app/dist /usr/share/nginx/html

# å¤åˆ¶nginxé…ç½®
COPY nginx.conf /etc/nginx/nginx.conf

# æš´éœ²ç«¯å£
EXPOSE 80

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost/ || exit 1

# nginxä¼šè‡ªåŠ¨å¯åŠ¨