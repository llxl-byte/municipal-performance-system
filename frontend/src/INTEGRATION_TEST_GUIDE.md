# 🔧 前后端集成测试指南

## 📋 概述

本指南详细说明了市政业绩管理系统前后端集成功能的测试方法和验证步骤。

## 🎯 测试目标

验证以下核心功能的完整集成：
1. ✅ 上传组件与后端上传API的集成
2. ✅ ProTable与后端查询API的集成  
3. ✅ 搜索状态管理和URL同步
4. ✅ 完整的上传-查询流程
5. ✅ 用户体验和交互反馈优化

## 🚀 快速开始

### 1. 启动服务

```bash
# 启动后端服务
cd backend
npm run dev

# 启动前端服务  
cd frontend
npm run dev
```

### 2. 访问测试页面

打开浏览器访问：`http://localhost:3000/test`

### 3. 运行自动化测试

点击"开始集成测试"按钮，系统将自动执行所有测试项目。

## 📊 测试项目详解

### 测试1：健康检查 🏥

**目标**：验证后端API服务状态

**测试步骤**：
- 调用 `GET /api/health` 基础健康检查
- 调用 `GET /api/health/detailed` 详细健康检查

**预期结果**：
```json
{
  "success": true,
  "message": "API服务正常",
  "data": {
    "status": "healthy",
    "timestamp": "2024-01-15T10:30:00Z"
  }
}
```

### 测试2：数据查询 📊

**目标**：测试项目数据获取功能

**测试步骤**：
- 调用 `GET /api/projects?page=1&pageSize=10`
- 验证返回数据格式和结构

**预期结果**：
```json
{
  "success": true,
  "data": {
    "items": [...],
    "total": 100,
    "page": 1,
    "pageSize": 10
  }
}
```

### 测试3：搜索功能 🔍

**目标**：验证项目名称搜索功能

**测试步骤**：
- 获取现有项目数据
- 使用项目名称关键词进行搜索
- 验证搜索结果的准确性

**预期结果**：
- 搜索结果包含匹配的项目
- 总数正确反映搜索结果数量

### 测试4：分页功能 📄

**目标**：测试数据分页加载

**测试步骤**：
- 请求第一页数据（pageSize=5）
- 如果数据充足，请求第二页数据
- 验证分页逻辑正确性

**预期结果**：
- 每页返回正确数量的数据
- 总数在各页保持一致
- 不同页面返回不同的数据项

### 测试5：上传功能 📤

**目标**：验证文件上传和数据导入

**测试步骤**：
- 调用模拟上传API `POST /api/upload`
- 验证返回的导入结果

**预期结果**：
```json
{
  "success": true,
  "data": {
    "importResult": {
      "totalRows": 10,
      "insertedRows": 8,
      "duplicateRows": 2
    }
  }
}
```

### 测试6：缓存功能 💾

**目标**：检查Redis缓存效果

**测试步骤**：
- 发送相同的查询请求两次
- 比较响应时间差异
- 检查缓存标识

**预期结果**：
- 第二次请求响应时间更短
- 缓存命中标识为true

## 🔧 手动测试步骤

### 1. 完整上传-查询流程测试

1. **上传文件**：
   - 访问 `/upload` 页面
   - 上传Excel文件（可使用项目根目录的`市政业绩.xlsx`）
   - 验证上传成功提示

2. **查看数据**：
   - 点击"查看导入数据"按钮
   - 自动跳转到项目管理页面
   - 验证新导入的数据显示

3. **搜索测试**：
   - 在项目名称搜索框输入关键词
   - 验证实时搜索效果
   - 检查URL参数同步

4. **分页测试**：
   - 切换不同页码
   - 修改每页显示条数
   - 验证URL参数保持

### 2. URL同步功能测试

1. **搜索条件同步**：
   - 在搜索框输入关键词
   - 检查URL中的`search`参数
   - 刷新页面验证搜索条件保持

2. **分页参数同步**：
   - 切换到第2页
   - 检查URL中的`page`参数
   - 修改每页条数，检查`pageSize`参数

3. **书签功能**：
   - 复制带参数的URL
   - 在新标签页打开
   - 验证搜索和分页状态正确恢复

### 3. 用户体验测试

1. **加载状态**：
   - 观察数据加载时的loading效果
   - 验证骨架屏或进度条显示

2. **错误处理**：
   - 断开网络连接
   - 尝试操作，观察错误提示
   - 恢复网络，验证重试功能

3. **响应式设计**：
   - 调整浏览器窗口大小
   - 验证移动端适配效果
   - 测试触摸操作

## 📱 移动端测试

### 1. 响应式布局
- 在手机浏览器中打开系统
- 验证表格在小屏幕下的显示效果
- 测试搜索和分页功能

### 2. 触摸交互
- 测试触摸滚动
- 验证按钮点击响应
- 检查表单输入体验

## 🐛 常见问题排查

### 1. 后端连接问题

**症状**：健康检查失败
**排查步骤**：
1. 检查后端服务是否启动：`http://localhost:3001/api/health`
2. 查看后端控制台日志
3. 验证端口是否被占用

### 2. 数据库连接问题

**症状**：数据查询失败
**排查步骤**：
1. 检查PostgreSQL服务状态
2. 验证数据库连接配置
3. 确认数据表是否存在

### 3. 缓存问题

**症状**：缓存测试失败
**排查步骤**：
1. 检查Redis服务状态
2. 验证Redis连接配置
3. 查看缓存键是否正确生成

### 4. 前端路由问题

**症状**：页面跳转异常
**排查步骤**：
1. 检查React Router配置
2. 验证URL参数格式
3. 查看浏览器控制台错误

## 📈 性能基准

### 响应时间标准
- 健康检查：< 100ms
- 数据查询（无缓存）：< 500ms
- 数据查询（有缓存）：< 100ms
- 搜索功能：< 300ms
- 文件上传：< 2s（10MB以内）

### 缓存效果
- 缓存命中率：> 80%
- 响应时间提升：> 50%
- 缓存过期时间：60秒

## 🎯 测试通过标准

### 功能测试
- ✅ 所有API请求返回成功状态
- ✅ 数据格式符合接口规范
- ✅ 搜索结果准确匹配关键词
- ✅ 分页逻辑正确无误
- ✅ 上传功能正常工作

### 性能测试
- ✅ 响应时间符合基准要求
- ✅ 缓存机制有效提升性能
- ✅ 并发请求处理正常

### 用户体验
- ✅ 加载状态清晰可见
- ✅ 错误提示友好准确
- ✅ 操作反馈及时有效
- ✅ 响应式设计适配良好

## 📝 测试报告模板

```markdown
# 集成测试报告

## 测试环境
- 前端版本：v1.0.0
- 后端版本：v1.0.0
- 测试时间：2024-01-15 10:30:00
- 测试人员：[姓名]

## 测试结果
| 测试项目 | 状态 | 响应时间 | 备注 |
|---------|------|----------|------|
| 健康检查 | ✅ | 50ms | 正常 |
| 数据查询 | ✅ | 200ms | 正常 |
| 搜索功能 | ✅ | 150ms | 正常 |
| 分页功能 | ✅ | 180ms | 正常 |
| 上传功能 | ✅ | 1.2s | 正常 |
| 缓存功能 | ✅ | 80ms | 缓存命中 |

## 问题记录
- 无

## 总结
所有集成测试项目均通过，系统功能正常。
```

## 🔗 相关文档

- [API接口文档](../services/api.ts)
- [ProTable组件说明](../components/ProTable-README.md)
- [上传组件文档](../components/UploadComponent.tsx)
- [项目需求文档](../../.kiro/specs/municipal-performance-system/requirements.md)
- [系统设计文档](../../.kiro/specs/municipal-performance-system/design.md)